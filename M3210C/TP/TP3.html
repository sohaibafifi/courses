<!DOCTYPE html>
<html lang="fr-FR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>M3210C - TP3 - Introduction aux threads | Cours - Sohaib LAFIFI</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.cdc477d6.css" as="style"><link rel="preload" href="/assets/js/app.0820327e.js" as="script"><link rel="preload" href="/assets/js/2.53d31978.js" as="script"><link rel="preload" href="/assets/js/10.b00f197e.js" as="script"><link rel="prefetch" href="/assets/js/11.1d29fa58.js"><link rel="prefetch" href="/assets/js/12.476e2b54.js"><link rel="prefetch" href="/assets/js/13.ca54079a.js"><link rel="prefetch" href="/assets/js/14.74993fb0.js"><link rel="prefetch" href="/assets/js/15.f48671b0.js"><link rel="prefetch" href="/assets/js/16.6d263f7c.js"><link rel="prefetch" href="/assets/js/17.cc1d39d7.js"><link rel="prefetch" href="/assets/js/18.b56ee655.js"><link rel="prefetch" href="/assets/js/19.8d81cacd.js"><link rel="prefetch" href="/assets/js/20.5b3fbf53.js"><link rel="prefetch" href="/assets/js/21.96b66c58.js"><link rel="prefetch" href="/assets/js/22.28a368d3.js"><link rel="prefetch" href="/assets/js/23.c5aba24b.js"><link rel="prefetch" href="/assets/js/24.1c779419.js"><link rel="prefetch" href="/assets/js/25.eb14d024.js"><link rel="prefetch" href="/assets/js/26.c1d78b42.js"><link rel="prefetch" href="/assets/js/27.438d75a6.js"><link rel="prefetch" href="/assets/js/28.ccd8c4ab.js"><link rel="prefetch" href="/assets/js/29.cb406640.js"><link rel="prefetch" href="/assets/js/3.ba16c78c.js"><link rel="prefetch" href="/assets/js/30.7fa71e98.js"><link rel="prefetch" href="/assets/js/31.064da601.js"><link rel="prefetch" href="/assets/js/32.dd663240.js"><link rel="prefetch" href="/assets/js/33.284d1781.js"><link rel="prefetch" href="/assets/js/34.5a7bd63d.js"><link rel="prefetch" href="/assets/js/35.933d35de.js"><link rel="prefetch" href="/assets/js/36.3a398051.js"><link rel="prefetch" href="/assets/js/37.a2b75d45.js"><link rel="prefetch" href="/assets/js/38.f68fe24c.js"><link rel="prefetch" href="/assets/js/39.9d3b3469.js"><link rel="prefetch" href="/assets/js/4.8b130817.js"><link rel="prefetch" href="/assets/js/40.3e14e6e2.js"><link rel="prefetch" href="/assets/js/41.2aabc14e.js"><link rel="prefetch" href="/assets/js/42.2c285354.js"><link rel="prefetch" href="/assets/js/43.b8ce584f.js"><link rel="prefetch" href="/assets/js/44.88201ae5.js"><link rel="prefetch" href="/assets/js/45.0dabf09d.js"><link rel="prefetch" href="/assets/js/46.9da80039.js"><link rel="prefetch" href="/assets/js/47.560a0975.js"><link rel="prefetch" href="/assets/js/48.8f6c31ae.js"><link rel="prefetch" href="/assets/js/49.07baa437.js"><link rel="prefetch" href="/assets/js/5.4bc0b6aa.js"><link rel="prefetch" href="/assets/js/50.e5684287.js"><link rel="prefetch" href="/assets/js/51.02d3b9b0.js"><link rel="prefetch" href="/assets/js/52.d333510e.js"><link rel="prefetch" href="/assets/js/53.1706e1f4.js"><link rel="prefetch" href="/assets/js/54.027f1544.js"><link rel="prefetch" href="/assets/js/6.c59f320e.js"><link rel="prefetch" href="/assets/js/7.16699103.js"><link rel="prefetch" href="/assets/js/8.7e664057.js"><link rel="prefetch" href="/assets/js/9.7279b4c1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cdc477d6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Cours - Sohaib LAFIFI</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Modules
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Modules
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">Modules</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/M2102-2/" class="sidebar-heading clickable"><span>M2102-2 : Virtualisation</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/M2105/" class="sidebar-heading clickable"><span>M2105 : Web dynamique</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/M2207/" class="sidebar-heading clickable"><span>M2207 : Consolidation des bases de la programmation (19-20)</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/M3210C/" class="sidebar-heading clickable router-link-active open"><span>M3210C : Programmation avancée</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/M3210C/CM/" class="sidebar-heading clickable"><span>CM</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/M3210C/TP/" class="sidebar-heading clickable router-link-active open"><span>TP</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/M3210C/TP/TP1.html" class="sidebar-link">TP1 - Programmation OO</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#objectif-de-ce-tp" class="sidebar-link">Objectif de ce TP</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#exercice-n°1" class="sidebar-link">Exercice n°1</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#exercice-n°2" class="sidebar-link">Exercice n°2</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#exercice-n°3" class="sidebar-link">Exercice n°3</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#synthese-partie-1" class="sidebar-link">Synthèse partie 1</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#exercice-n°5" class="sidebar-link">Exercice n°5</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#exercice-n°6" class="sidebar-link">Exercice n°6</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#exercice-n°7" class="sidebar-link">Exercice n°7</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#exercice-n°8" class="sidebar-link">Exercice n°8</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#synthese-partie-2" class="sidebar-link">Synthèse partie 2</a></li></ul></li><li><a href="/M3210C/TP/TP2.html" class="sidebar-link">TP2 - Programmation OO suite</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/M3210C/TP/TP2.html#objectif-de-ce-tp" class="sidebar-link">Objectif de ce TP</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP2.html#exercice-n°1-capter-et-gerer-les-exceptions-monentier" class="sidebar-link">Exercice n°1 - Capter et Gérer les exceptions (MonEntier)</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP2.html#exercice-n°2-entrees-sorties-fichiers" class="sidebar-link">Exercice n°2 - Entrées/sorties fichiers</a></li></ul></li><li><a href="/M3210C/TP/TP3.html" class="active sidebar-link">TP3 - Introduction aux threads</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/M3210C/TP/TP3.html#objectif-de-ce-tp" class="sidebar-link">Objectif de ce TP</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP3.html#les-threads-en-java" class="sidebar-link">Les threads en Java</a></li></ul></li><li><a href="/M3210C/TP/TP4.html" class="sidebar-link">TP4 - Introduction aux sockets</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/M3210C/TP/TP4.html#objectif-de-ce-tp" class="sidebar-link">Objectif de ce TP</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP4.html#recuperer-une-adresse-ip-avec-inetaddress" class="sidebar-link">Récupérer une adresse IP avec InetAddress</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP4.html#qu-est-ce-qu-un-socket" class="sidebar-link">Qu'est-ce qu'un socket ?</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP4.html#echange-de-message" class="sidebar-link">Échange de message</a></li></ul></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/M23/" class="sidebar-heading clickable"><span>M23 - Administration systèmes</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/M31/" class="sidebar-heading clickable"><span>M31 - Outils informatiques</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/M36/" class="sidebar-heading clickable"><span>M36 - Services mobiles</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="m3210c-tp3-introduction-aux-threads"><a href="#m3210c-tp3-introduction-aux-threads" class="header-anchor">#</a> M3210C - TP3 : Introduction aux threads</h1> <blockquote><p>durée : 2h</p></blockquote> <h2 id="objectif-de-ce-tp"><a href="#objectif-de-ce-tp" class="header-anchor">#</a> Objectif de ce TP</h2> <p>Vous initier aux threads.</p> <h2 id="les-threads-en-java"><a href="#les-threads-en-java" class="header-anchor">#</a> Les threads en Java</h2> <p>Un <strong>thread</strong> est une portion de code pouvant s'exécuter en &quot;parallèle&quot; d'autres threads. En réalité, les threads s'exécutent suivant un temps CPU partagé. Le CPU donne du temps aléatoirement à chacun des threads existant de façon à leur laisser une chance s'exécuter.</p> <p>En Java, il y a deux façon de créer un thread : en <strong>héritant de la classe Thread</strong> ou en <strong>implémentant l'interface Runnable</strong></p> <h3 id="en-heritant-de-la-classe-thread"><a href="#en-heritant-de-la-classe-thread" class="header-anchor">#</a> En héritant de la classe Thread</h3> <p>La classe suivante montre un exemple.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadExemple1</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
			
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/* Travail du Thread */</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Je suis un thread ThreadExemple1 et mon nom est &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadExemple1</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadExemple1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Je suis le processus principal et mon nom est &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>La classe <code>ThreadExemple1</code> hérite (étend) la classe <code>Thread</code> et redéfinit (&quot;override&quot;) la méthode <code>run()</code>.</p> <p>Dans la méthode <code>run()</code>, on écrit ce que fait le thread.</p> <p>Pour lancer le thread dans la fonction principale il faut utiliser la méthode <code>start()</code>.</p> <ul><li>Testez cette classe. Exécutez la plusieurs fois.</li></ul> <p>Vous obtenez :</p> <div class="language- extra-class"><pre class="language-text"><code>Je suis le processus principal et mon nom est main
Je suis un thread ThreadExemple1 et mon nom est Thread-0
</code></pre></div><p>ou</p> <div class="language- extra-class"><pre class="language-text"><code>Je suis un thread ThreadExemple1 et mon nom est Thread-0
Je suis le processus principal et mon nom est main
</code></pre></div><p>Vous voyez deux processus : le processus principal (l'exécution de la classe) dont le nom est <strong>main</strong> et le thread créé dont le nom est <strong>Thread-0</strong>.</p> <ul><li>Ajoutez d'autres threads à lancer dans la fonction principale pour voir le résulat (relancez plusieurs fois pour voir le côté aléatoire de l'exécution des threads).</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadExemple1</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadExemple1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ThreadExemple1</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadExemple1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ThreadExemple1</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadExemple1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Je suis le processus principal et mon nom est &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ou</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">ThreadExemple1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">ThreadExemple1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">ThreadExemple1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Je suis le processus principal et mon nom est &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>La classe suivante illustre un deuxième exemple avec un constructeur.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadExemple2</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">ThreadExemple2</span><span class="token punctuation">(</span><span class="token class-name">String</span> nom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>nom<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/* Travail du Thread */</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Je suis un thread ThreadExemple2 et mon nom est &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">ThreadExemple2</span><span class="token punctuation">(</span><span class="token string">&quot;Will&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">ThreadExemple2</span><span class="token punctuation">(</span><span class="token string">&quot;Mickey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">ThreadExemple2</span><span class="token punctuation">(</span><span class="token string">&quot;James&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Je suis le processus principal et mon nom est &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Testez cette classe en l'exécutant plusieurs fois.</li></ul> <h3 id="threads-en-implementant-l-interface-runnable"><a href="#threads-en-implementant-l-interface-runnable" class="header-anchor">#</a> Threads en implémentant l'interface Runnable</h3> <ul><li>Testez le programme suivant.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
 
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello d'un thread créé à partir d'un Runnable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">HelloRunnable</span> hr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="allons-un-peu-plus-loin"><a href="#allons-un-peu-plus-loin" class="header-anchor">#</a> Allons un peu plus loin</h3> <ul><li>Pour mettre un peu de couleurs pour différencier vos threads, testez le programme suivant.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Testcouleur</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\033[3&quot;</span><span class="token operator">+</span>i<span class="token operator">+</span><span class="token string">&quot;m Avec i = &quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Testez la classe suivante illustrant un troisième exemple avec des attributs pour la classe (une variable de classe (i.e. une variable commune à toutes les instances), une constante d'instance (chaque instance à sa constante), un constructeur et une redéfinition de la méthode toString (pour afficher plus facilement un Thread).</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadExemple3</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> nbThreads <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* Rappel : c'est une variable de classe (mot clé static)*/</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> NUM<span class="token punctuation">;</span> <span class="token comment">/* Rappel : c'est une constante (mot clé final) d'instance (pas le mot clé static)*/</span>

    <span class="token keyword">public</span> <span class="token class-name">ThreadExemple3</span><span class="token punctuation">(</span><span class="token class-name">String</span> nom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>nom<span class="token punctuation">)</span><span class="token punctuation">;</span>
        NUM<span class="token operator">=</span>nbThreads<span class="token punctuation">;</span>
        nbThreads<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/* Travail du Thread */</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;\033[3&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>NUM<span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;mJe suis #Thread&quot;</span> <span class="token operator">+</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">ThreadExemple3</span><span class="token punctuation">(</span><span class="token string">&quot;Will&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">ThreadExemple3</span><span class="token punctuation">(</span><span class="token string">&quot;Mickey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">ThreadExemple3</span><span class="token punctuation">(</span><span class="token string">&quot;James&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Je suis le processus principal et mon nom est &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Il est aussi possible de démarrer un thread dès sa construction</p> <ul><li>Créer une nouvelle classe ThreadExemple4 faisant la même chose que la classe ThreadExemple3 mais utilisant le constructeur suivant</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ThreadExemple4</span><span class="token punctuation">(</span><span class="token class-name">String</span> nom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>nom<span class="token punctuation">)</span><span class="token punctuation">;</span>
    NUM<span class="token operator">=</span>nbThreads<span class="token punctuation">;</span>
    nbThreads<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Vous remarquez que l'IDE vous met un message d'avertissement &quot;***Starting a new Thread in constructor is dangerous and should be prevented.***&quot; (vous ne le ferez que pour gagner du temps sur vos tests).</p> <ul><li>Testez la classe suivante</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadCompteur</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">private</span> <span class="token keyword">int</span> cr <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> nbThreads <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> NUM<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ThreadCompteur</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span> <span class="token operator">+</span> nbThreads<span class="token punctuation">)</span><span class="token punctuation">;</span>
        NUM<span class="token operator">=</span>nbThreads<span class="token punctuation">;</span>
        nbThreads<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;\033[3&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>NUM<span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;m #Thread&quot;</span> <span class="token operator">+</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; : &quot;</span> <span class="token operator">+</span> cr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">--</span>cr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\033[3&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>NUM<span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;m &quot;</span>
                        <span class="token operator">+</span> <span class="token string">&quot;#Thread&quot;</span> <span class="token operator">+</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; : FINI !&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">ThreadCompteur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Remarquez quelques éléments un peu technique : (1) --cr == 0 décrémente cr avant de tester si cr vaut 0, et (2) emploi du return pour stopper le thread (fin méthode run()).</p></div> <ul><li>Que fait chaque thread ThreadCompteur ? Relancez plusieurs fois cette classe ThreadCompteur</li></ul> <p>On peut obtenir quelque chose comme ceci :</p> <p><img src="/assets/img/threads0.a7c50124.png" alt=""></p> <p>Comment faire si on veut que les threads comptent à rebours en même temps c'est-à-dire qu'on obtienne toujours le même résultat suivant :</p> <p><img src="/assets/img/threads1.921852e5.png" alt=""></p> <p>Une façon de faire consiste à endormir un thread pour laisser du temps aux autres. Pour ce faire vous pouvez utilisez la méthode sleep (public static void sleep(long millis) throws InterruptedException) comme ceci :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// thread endormi 100ms</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Exception : &quot;</span><span class="token operator">+</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Créez une classe <strong>ThreadCompteurv2</strong> donnant un résultat où tous les threads comptent à rebours en même temps.</li></ul> <p><strong>Remarque</strong> : il existe aussi la méthode <strong>yield</strong> (public static void yield()) indiquant que le thread &quot;peut laisser la main&quot; à un autre thread (l'ordonnanceur des threads n'est pas obligé de le respecter).</p> <ul><li>Testez votre classe avec un <strong>yield</strong> à la place du <strong>sleep</strong>.</li></ul> <p>Vous disposez également de la méthode <strong>join</strong> (public final void join() throws InterruptedException &quot;Waits for this thread to die&quot;) permettant d'attendre qu'un thread ait fini. Exemple :</p> <div class="language-java extra-class"><pre class="language-java"><code>t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* Le code ci-après ne s'exécutera que quand t1 aura fini.*/</span>
</code></pre></div><p>Pour permettre l'exécution d'un bloc de code par un thread sans qu'il ne soit interrompu par un autre thread, vous avez le mot clé synchronized.</p> <p>Il peut s'appliquer sur une méthode :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">methode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* une méthode synchronisée / accès bloqué pour les autres méthodes synchronisées */</span><span class="token punctuation">}</span>
</code></pre></div><p>Lorsque vous appelez une méthode d'instance synchronisée, cet objet est bloqué et aucune autre méthode synchronisée de cet objet ne peut être appelée avant la fin de l'excution de cette méthode.</p> <div class="custom-block danger"><p class="custom-block-title">Attention</p> <p>Attention une méthode non synchronisée ou du code non synchronisé peut venir exécuter un bloc synchronisé ou une méthode synchronisée...</p></div> <p>On peut aussi déclarer un bloc d'instructions comme étant synchronisé :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">synchronized</span><span class="token punctuation">(</span>objectidentifier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">/* Accès bloqué pour les autres méthodes synchronisées */</span> 
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Dernière modification :</span> <span class="time">21-04-2021</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/M3210C/TP/TP2.html" class="prev">
        TP2 - Programmation OO suite
      </a></span> <span class="next"><a href="/M3210C/TP/TP4.html">
        TP4 - Introduction aux sockets
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0820327e.js" defer></script><script src="/assets/js/2.53d31978.js" defer></script><script src="/assets/js/10.b00f197e.js" defer></script>
  </body>
</html>
