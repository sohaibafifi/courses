<!DOCTYPE html>
<html lang="fr-FR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>M3210C - TP4 - Introduction aux sockets | Cours - Sohaib LAFIFI</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.cdc477d6.css" as="style"><link rel="preload" href="/assets/js/app.0612ea55.js" as="script"><link rel="preload" href="/assets/js/2.53d31978.js" as="script"><link rel="preload" href="/assets/js/52.d333510e.js" as="script"><link rel="prefetch" href="/assets/js/10.b00f197e.js"><link rel="prefetch" href="/assets/js/11.1d29fa58.js"><link rel="prefetch" href="/assets/js/12.476e2b54.js"><link rel="prefetch" href="/assets/js/13.ca54079a.js"><link rel="prefetch" href="/assets/js/14.74993fb0.js"><link rel="prefetch" href="/assets/js/15.f48671b0.js"><link rel="prefetch" href="/assets/js/16.6d263f7c.js"><link rel="prefetch" href="/assets/js/17.cc1d39d7.js"><link rel="prefetch" href="/assets/js/18.b56ee655.js"><link rel="prefetch" href="/assets/js/19.8d81cacd.js"><link rel="prefetch" href="/assets/js/20.5b3fbf53.js"><link rel="prefetch" href="/assets/js/21.96b66c58.js"><link rel="prefetch" href="/assets/js/22.28a368d3.js"><link rel="prefetch" href="/assets/js/23.c5aba24b.js"><link rel="prefetch" href="/assets/js/24.1c779419.js"><link rel="prefetch" href="/assets/js/25.eb14d024.js"><link rel="prefetch" href="/assets/js/26.c1d78b42.js"><link rel="prefetch" href="/assets/js/27.438d75a6.js"><link rel="prefetch" href="/assets/js/28.ccd8c4ab.js"><link rel="prefetch" href="/assets/js/29.cb406640.js"><link rel="prefetch" href="/assets/js/3.ba16c78c.js"><link rel="prefetch" href="/assets/js/30.7fa71e98.js"><link rel="prefetch" href="/assets/js/31.064da601.js"><link rel="prefetch" href="/assets/js/32.dd663240.js"><link rel="prefetch" href="/assets/js/33.284d1781.js"><link rel="prefetch" href="/assets/js/34.5a7bd63d.js"><link rel="prefetch" href="/assets/js/35.933d35de.js"><link rel="prefetch" href="/assets/js/36.3a398051.js"><link rel="prefetch" href="/assets/js/37.a2b75d45.js"><link rel="prefetch" href="/assets/js/38.f68fe24c.js"><link rel="prefetch" href="/assets/js/39.9d3b3469.js"><link rel="prefetch" href="/assets/js/4.8b130817.js"><link rel="prefetch" href="/assets/js/40.3e14e6e2.js"><link rel="prefetch" href="/assets/js/41.2aabc14e.js"><link rel="prefetch" href="/assets/js/42.2c285354.js"><link rel="prefetch" href="/assets/js/43.b8ce584f.js"><link rel="prefetch" href="/assets/js/44.88201ae5.js"><link rel="prefetch" href="/assets/js/45.0dabf09d.js"><link rel="prefetch" href="/assets/js/46.9da80039.js"><link rel="prefetch" href="/assets/js/47.560a0975.js"><link rel="prefetch" href="/assets/js/48.8f6c31ae.js"><link rel="prefetch" href="/assets/js/49.07baa437.js"><link rel="prefetch" href="/assets/js/5.a799cd84.js"><link rel="prefetch" href="/assets/js/50.e5684287.js"><link rel="prefetch" href="/assets/js/51.02d3b9b0.js"><link rel="prefetch" href="/assets/js/53.1706e1f4.js"><link rel="prefetch" href="/assets/js/54.027f1544.js"><link rel="prefetch" href="/assets/js/6.c59f320e.js"><link rel="prefetch" href="/assets/js/7.16699103.js"><link rel="prefetch" href="/assets/js/8.7e664057.js"><link rel="prefetch" href="/assets/js/9.7279b4c1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cdc477d6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Cours - Sohaib LAFIFI</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Modules
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Modules
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">Modules</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/M2102-2/" class="sidebar-heading clickable"><span>M2102-2 : Virtualisation</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/M2105/" class="sidebar-heading clickable"><span>M2105 : Web dynamique</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/M2207/" class="sidebar-heading clickable"><span>M2207 : Consolidation des bases de la programmation (19-20)</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/M3210C/" class="sidebar-heading clickable router-link-active open"><span>M3210C : Programmation avancée</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/M3210C/CM/" class="sidebar-heading clickable"><span>CM</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/M3210C/TP/" class="sidebar-heading clickable router-link-active open"><span>TP</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/M3210C/TP/TP1.html" class="sidebar-link">TP1 - Programmation OO</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#objectif-de-ce-tp" class="sidebar-link">Objectif de ce TP</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#exercice-n°1" class="sidebar-link">Exercice n°1</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#exercice-n°2" class="sidebar-link">Exercice n°2</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#exercice-n°3" class="sidebar-link">Exercice n°3</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#synthese-partie-1" class="sidebar-link">Synthèse partie 1</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#exercice-n°5" class="sidebar-link">Exercice n°5</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#exercice-n°6" class="sidebar-link">Exercice n°6</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#exercice-n°7" class="sidebar-link">Exercice n°7</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#exercice-n°8" class="sidebar-link">Exercice n°8</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP1.html#synthese-partie-2" class="sidebar-link">Synthèse partie 2</a></li></ul></li><li><a href="/M3210C/TP/TP2.html" class="sidebar-link">TP2 - Programmation OO suite</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/M3210C/TP/TP2.html#objectif-de-ce-tp" class="sidebar-link">Objectif de ce TP</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP2.html#exercice-n°1-capter-et-gerer-les-exceptions-monentier" class="sidebar-link">Exercice n°1 - Capter et Gérer les exceptions (MonEntier)</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP2.html#exercice-n°2-entrees-sorties-fichiers" class="sidebar-link">Exercice n°2 - Entrées/sorties fichiers</a></li></ul></li><li><a href="/M3210C/TP/TP3.html" class="sidebar-link">TP3 - Introduction aux threads</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/M3210C/TP/TP3.html#objectif-de-ce-tp" class="sidebar-link">Objectif de ce TP</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP3.html#les-threads-en-java" class="sidebar-link">Les threads en Java</a></li></ul></li><li><a href="/M3210C/TP/TP4.html" class="active sidebar-link">TP4 - Introduction aux sockets</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/M3210C/TP/TP4.html#objectif-de-ce-tp" class="sidebar-link">Objectif de ce TP</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP4.html#recuperer-une-adresse-ip-avec-inetaddress" class="sidebar-link">Récupérer une adresse IP avec InetAddress</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP4.html#qu-est-ce-qu-un-socket" class="sidebar-link">Qu'est-ce qu'un socket ?</a></li><li class="sidebar-sub-header"><a href="/M3210C/TP/TP4.html#echange-de-message" class="sidebar-link">Échange de message</a></li></ul></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/M23/" class="sidebar-heading clickable"><span>M23 - Administration systèmes</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/M31/" class="sidebar-heading clickable"><span>M31 - Outils informatiques</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/M36/" class="sidebar-heading clickable"><span>M36 - Services mobiles</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="m3210c-tp4-introduction-aux-sockets"><a href="#m3210c-tp4-introduction-aux-sockets" class="header-anchor">#</a> M3210C - TP4 : Introduction aux sockets</h1> <blockquote><p>durée : 4h</p></blockquote> <h2 id="objectif-de-ce-tp"><a href="#objectif-de-ce-tp" class="header-anchor">#</a> Objectif de ce TP</h2> <p>Vous initier aux sockets.</p> <h2 id="recuperer-une-adresse-ip-avec-inetaddress"><a href="#recuperer-une-adresse-ip-avec-inetaddress" class="header-anchor">#</a> Récupérer une adresse IP avec InetAddress</h2> <p>Le package java.net de la plate-forme Java fournit une classe InetAddress qui nous permet de récupérer et manipuler son adresse internet, IP pour les intimes. Cette classe n'a pas de constructeur, pour pouvoir avoir une instance de cette classe on a besoin des méthodes de classe. Voici les méthodes dont je vous parle :</p> <ul><li><p><code>getLocalHost()</code> : elle retourne un objet qui contient l'adresse IP de la machine locale.</p></li> <li><p><code>getByName(String nom_de_l_machine)</code> : elle retourne un objet qui contient l'adresse IP de la machine dont le nom est passé en paramètre.</p></li> <li><p><code>getAllByName(String nom_de_l_machine)</code> : elle retourne un tableau d'objets qui contient l'ensemble d'adresses IP de la machine qui correspond au nom passé en paramètre.</p></li></ul> <p>A présent, voyons les méthodes applicables à un objet de cette classe :</p> <ul><li><p><code>getHostName()</code> : elle retourne le nom de la machine dont l'adresse est stockée dans l'objet.</p></li> <li><p><code>getAddress()</code> : elle retourne l'adresse IP stockée dans l'objet sous forme d'un tableau de 4 octets.</p></li> <li><p><code>toString()</code> : elle retourne un String qui correspond au nom de la machine et son adresse.</p></li></ul> <p>Et pour terminer un petit exemple :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">InetAddress</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">UnknownHostException</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Adressage</span> <span class="token punctuation">{</span>
	
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> zero<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		
		<span class="token class-name">InetAddress</span> <span class="token class-name">LocaleAdresse</span> <span class="token punctuation">;</span>
		<span class="token class-name">InetAddress</span> <span class="token class-name">ServeurAdresse</span><span class="token punctuation">;</span>

		<span class="token keyword">try</span> <span class="token punctuation">{</span>

			<span class="token class-name">LocaleAdresse</span> <span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getLocalHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;L'adresse locale est : &quot;</span><span class="token operator">+</span><span class="token class-name">LocaleAdresse</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
			
			<span class="token class-name">ServeurAdresse</span><span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token string">&quot;rt-bethune.univ-artois.fr&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;L'adresse du serveur du département RT est : &quot;</span><span class="token operator">+</span><span class="token class-name">ServeurAdresse</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownHostException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="qu-est-ce-qu-un-socket"><a href="#qu-est-ce-qu-un-socket" class="header-anchor">#</a> Qu'est-ce qu'un socket ?</h2> <p>Un socket est un point de terminaison d'une communication bidirectionnelle, c'est-à-dire entre un client et un serveur en cours d'exécution sur un réseau donné. Les deux sont liés par un même numéro de port TCP de sorte que la couche puisse identifier la demande de partage de données.</p> <p>Un serveur fonctionne sur une machine bien définie et est lié à un numéro de port spécifique. Le serveur se met simplement à l'écoute d'un client, qui demande une connexion.</p> <p>En outre, java.net comprend la classe ServerSocket, qui met en oeuvre une sorte de prise que les serveurs peuvent utiliser pour écouter et accepter les connexions des clients. Ce qui nous donne :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ServerSocket</span> socketserver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span>numero_port<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Ainsi on obtient un objet de la classe ServerSocket sur un port spécifique : si ce dernier est à 0, le socket est créée sur n'importe quel port libre.</p> <p>Il existe deux autres constructeurs ; l'un a deux paramètres, le premier est bien sûr le numéro de port et le nombre total de connexion simultanées acceptées, voyez :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ServerSocket</span> socketserver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span>numer_port<span class="token punctuation">,</span>nbr_max<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>nbr_max</strong> est le nombre maximal de connexions traitées simultanément. Par exemple au-delà de cinq tentatives de connexion consécutives autorisées, les connexions sont refusés.</p> <p>Pour le second constructeur il suffit de spécifier l'adresse locale du serveur.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ServerSocket</span> socketserver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span>numer_port<span class="token punctuation">,</span>nbr_max<span class="token punctuation">,</span>adresse_locale<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Quant au client, celui-ci connaît le nom de la machine sur laquelle le serveur est en exécution et le numéro de port sur lequel il écoute. Le client va demander une connexion au serveur en s'identifiant avec son adresse IP ainsi que le numéro de port qui lui est lié.</p> <p>Pour cela, le package <code>java.net</code> fournit une classe <code>Socket</code> qui met en œuvre une connexion bidirectionnelle entre votre programme Java et un autre programme situé sur le réseau. La classe <code>Socket</code> permet de cacher les détails d'implémentation de cette connexion. En utilisant cette classe en lieu et place d'un code natif, vos programmes peuvent communiquer sur le réseau quel que soit la plateforme sur laquelle ils se trouvent. La création d'un socket pour un programme client s'effectue à l'aide d'un des constructeurs suivants :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span>param1<span class="token punctuation">,</span> param2<span class="token punctuation">)</span>
</code></pre></div><p>Le premier paramètre correspond à l'identité du client, il peut être une chaine de caractère ou de type InetAddress, param2 correspond au numéro de port sur lequel on souhaite se connecter sur le serveur. Il est possible également de spécifier son adresse local comme troisième paramètre et le numéro de port local :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span>adresse_distante<span class="token punctuation">,</span> port_distant<span class="token punctuation">,</span> adresse_locale<span class="token punctuation">,</span> port_locale<span class="token punctuation">)</span>
</code></pre></div><p>Après tentative de connexion, si tout va bien, le serveur accepte la connexion du client, et reçoit un nouveau socket qui est directement lié au même port local. Il a besoin d'une nouvelle prise de sorte qu'elle puisse continuer à écouter le socket d'origine pour les demandes de connexion, tout t'en satisfaisant les besoins du client connecté. Voici comment accepter une connexion d'un client :</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Socket</span> socketduserveur <span class="token operator">=</span> socketserver<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Une fois le socket créé, l'attente de connexion provenant du client se fait à l'aide de la méthode <code>accept()</code>.</p> <blockquote><p>La méthode <code>accept()</code> reste bloquante tant qu'elle n'a pas détecté de connexion.</p></blockquote> <p><strong>Côté client</strong>, si la connexion est acceptée, une socket est créé et le client peut utiliser la socket pour communiquer avec le serveur.</p> <p>L'établissement d'une connexion peut lever une exception de type <code>IOException</code>.</p> <p>On va essayer d'établir une communication. Vous avez tout les éléments à portée de main, vous pouvez désormais établir une connexion, au boulot !</p> <p>Le client et le serveur peuvent à présent communiquer par l'écriture ou la lecture.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Serveur.java</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">ServerSocket</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">Socket</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Serveur</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> zero<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		
		<span class="token class-name">ServerSocket</span> socketserver  <span class="token punctuation">;</span>
		<span class="token class-name">Socket</span> socketduserveur <span class="token punctuation">;</span>

		<span class="token keyword">try</span> <span class="token punctuation">{</span>
		
			socketserver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">2009</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			socketduserveur <span class="token operator">=</span> socketserver<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Un client s'est connecté !&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        socketserver<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        socketduserveur<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Client.java</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">InetAddress</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">Socket</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">UnknownHostException</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
	
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> zero<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		
		<span class="token class-name">Socket</span> socket<span class="token punctuation">;</span>

		<span class="token keyword">try</span> <span class="token punctuation">{</span>
		
		    socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getLocalHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2009</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownHostException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Lancez le serveur en premier et ensuite le client !</p></div> <div class="custom-block danger"><p class="custom-block-title">Attention</p> <p>il ne faut jamais oublier de fermer le socket ! Sinon si vous utilisez le même port dans un autre programme, ce (l'action de fermer une socket) ne sera plus possible car il (le port) sera occupé !</p></div> <h2 id="echange-de-message"><a href="#echange-de-message" class="header-anchor">#</a> Échange de message</h2> <p>Vous venez d'établir votre première connexion entre un serveur et un client. Maintenant, voyons comment envoyer et recevoir des messages.</p> <p>Une fois la connexion établie, il est possible de récupérer le flux d'entrée et de sortie de la connexion TCP vers le serveur. Il existe deux méthodes pour permettre la récupération des flux :</p> <ul><li><p><code>getInputStream()</code> de la classe <code>InputStream</code>. Elle nous permet de gérer les flux entrant ;</p></li> <li><p><code>getOutputStream()</code> de la classe <code>OuputStream</code>. Elle nous permet de gérer les flux sortant.</p></li></ul> <p>Ces deux méthodes nous permettent donc de gérer les flux en entrée et en sortie. En général le type d'entrée et sortie utilisé est <code>BufferedReader</code> et <code>InputStreamReader</code> pour la lecture, <code>PrintWriter</code> pour l'écriture. Mais on peut utiliser tous les autres flux.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Server.java</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">BufferedReader</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">InputStreamReader</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">PrintWriter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">InetAddress</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">ServerSocket</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">Socket</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">UnknownHostException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">PrintWriter</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Serveur</span> <span class="token punctuation">{</span>
	
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> zero<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		
		<span class="token class-name">ServerSocket</span> socketserver  <span class="token punctuation">;</span>
		<span class="token class-name">Socket</span> socketduserveur <span class="token punctuation">;</span>
		<span class="token class-name">BufferedReader</span> in<span class="token punctuation">;</span>
		<span class="token class-name">PrintWriter</span> out<span class="token punctuation">;</span>
		
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
		
			socketserver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">2009</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Le serveur est à l'écoute du port &quot;</span><span class="token operator">+</span>socketserver<span class="token punctuation">.</span><span class="token function">getLocalPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			socketduserveur <span class="token operator">=</span> socketserver<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
		        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Un client s'est connecté&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span>socketduserveur<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Vous êtes connecté !&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		                
		        socketduserveur<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        socketserver<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Client.java</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">BufferedReader</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">InputStreamReader</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">PrintWriter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">InetAddress</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">Socket</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">UnknownHostException</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
	
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> zero<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		
		
		<span class="token class-name">Socket</span> socket<span class="token punctuation">;</span>
		<span class="token class-name">BufferedReader</span> in<span class="token punctuation">;</span>
		<span class="token class-name">PrintWriter</span> out<span class="token punctuation">;</span>

		<span class="token keyword">try</span> <span class="token punctuation">{</span>
		
			socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getLocalHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2009</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
		        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Demande de connexion&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		        in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span> <span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        <span class="token class-name">String</span> message_distant <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>message_distant<span class="token punctuation">)</span><span class="token punctuation">;</span>
		        
		        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		       
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownHostException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>Résultat chez le serveur :</p> <div class="language- extra-class"><pre class="language-text"><code>Le serveur est à l'écoute du port 2009
Un client s'est connecté
</code></pre></div><p>Résultat chez le client :</p> <div class="language- extra-class"><pre class="language-text"><code>Demande de connexion
Vous êtes connecté !
</code></pre></div><h3 id="explications"><a href="#explications" class="header-anchor">#</a> Explications</h3> <h4 id="cote-serveur"><a href="#cote-serveur" class="header-anchor">#</a> Côté Serveur</h4> <p>Après établissement de la connexion, le serveur obtient son socket qu'il utilise pour gérer le flux sortant à l'aide de <code>socketduserveur.getOutputStream()</code> ; ensuite, à l'aide de la méthode <code>println</code> on envoie un message au client, on utilise <code>flush</code> pour vider le buffer tout simplement. Et pour finir on ferme la connexion.</p> <h4 id="cote-client"><a href="#cote-client" class="header-anchor">#</a> Côté Client</h4> <p>Après avoir obtenu notre socket, on utilise <code>socket.getInputStream()</code> pour récupérer le flux sortant. La méthode <code>readLine()</code> nous permet de lire une chaîne de caractères. Il existe plusieurs autres méthodes telles :</p> <p><code>readInt()</code> permettant de lire un entier ;</p> <p><code>readDouble()</code> permettant de lire un nombre de type double ;</p> <p>Pour finir, on affiche le message reçu et on ferme notre socket.</p> <p>Ça a l'air très simple à première vue pour deux hôtes, mais si l'on veut que plus que deux puissent communiquer entre eux à la fois, comment faire ? D'où la nécessité d'utiliser les Threads...</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Dernière modification :</span> <span class="time">21-04-2021</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/M3210C/TP/TP3.html" class="prev">
        TP3 - Introduction aux threads
      </a></span> <span class="next"><a href="/M23/CM/CM1.html">
        CM1 Commandes UNIX
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0612ea55.js" defer></script><script src="/assets/js/2.53d31978.js" defer></script><script src="/assets/js/52.d333510e.js" defer></script>
  </body>
</html>
