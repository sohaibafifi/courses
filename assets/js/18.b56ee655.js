(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{437:function(e,r,s){"use strict";s.r(r);var n=s(43),a=Object(n.a)({},(function(){var e=this,r=e.$createElement,s=e._self._c||r;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[e._v("#")]),e._v(" Docker")]),e._v(" "),s("h3",{attrs:{id:"installation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#installation"}},[e._v("#")]),e._v(" Installation")]),e._v(" "),s("p",[e._v("Docker fait partie des dépôts officiels à partir d’Ubuntu. Il suffit donc d'installer le paquet "),s("strong",[s("code",[e._v("docker.io")])]),e._v(". Puis démarrez le service avec : "),s("code",[e._v("systemctl start docker")]),e._v(".")]),e._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[e._v("Si vous êtes à l'IUT :")]),e._v(" "),s("p",[e._v("Docker cherche les images en local dans un premier temps. Si l'image n'existe pas il va alors tenter de télécharger la dernière version à partir du docker store (le hub). Puisque l’IUT utilise un proxy, il faut l’indiquer à Docker. Pour cela, il faut créer le répertoire suivant :")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("mkdir /etc/systemd/system/docker.service.d\n")])])]),s("p",[e._v("puis ajoutez le fichier "),s("code",[e._v("http-proxy.conf")]),e._v(" dans ce répertoire et écrire dedans :")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v('[Service]\nEnvironment="HTTP_PROXY=http://cache-etu.univ-artois.fr:3128/"\n')])])]),s("p",[e._v("Il faut ensuite redémarrer docker :")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("systemctl daemon-reload\nsystemctl restart docker\n")])])])]),e._v(" "),s("h3",{attrs:{id:"utilisation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#utilisation"}},[e._v("#")]),e._v(" Utilisation")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("Démarrons notre premier containers "),s("code",[e._v("docker run rtbethune/debian df -Th")]),e._v("\nQue se passe-t-il ?")])]),e._v(" "),s("li",[s("p",[e._v("Un container ne reste en vie que si un processus est actif. On peut lister les containers actifs avec la commande "),s("code",[e._v("docker ps")]),e._v(". On peut aussi lister tous les containers, actifs ou\ninactifs avec "),s("code",[e._v("docker ps -a")]),e._v(". Que vous retourne ces commandes et pourquoi ?")])]),e._v(" "),s("li",[s("p",[e._v("Nous allons maintenant rediriger l’entrée standard du container avec l’option "),s("code",[e._v("-i")]),e._v(" et ouvrir un pseudo-terminal avec "),s("code",[e._v("-t")]),e._v(", le tout en exécutant le processus "),s("code",[e._v("bash")]),e._v(" :")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("docker run -ti --name=debian rtbethune/debian bash\n")])])]),s("p",[e._v("Quelle est la version de debian du container (tapez "),s("code",[e._v("cat /etc/os-release")]),e._v(") et la version du noyou Linux  (tapez "),s("code",[e._v("uname -a")]),e._v(")?")])]),e._v(" "),s("li",[s("p",[e._v("Quelle est l'adresse ip du container ? Communiquer avec le système  hôte avec un "),s("code",[e._v("ping")]),e._v(".")])]),e._v(" "),s("li",[s("p",[e._v("Créez un ficher avec "),s("code",[e._v("touch test")]),e._v(" ou faites n'importe  quelle modification sur le container.")])]),e._v(" "),s("li",[s("p",[e._v("Ouvrez un second terminal. Listez les containers actifs ? Combien y  en a-t-il ? Notez leurs "),s("strong",[e._v("ID")]),e._v(".")])]),e._v(" "),s("li",[s("p",[e._v("Lorsque l'on fait des modification dans un container, on peut comparer à l'image d'origine avec : "),s("code",[e._v("docker diff ID")])])])]),e._v(" "),s("h2",{attrs:{id:"docker-compose"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[e._v("#")]),e._v(" Docker compose")]),e._v(" "),s("h3",{attrs:{id:"installation-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#installation-2"}},[e._v("#")]),e._v(" Installation")]),e._v(" "),s("p",[e._v("Nous allons maintenant installer docker-compose pour déclarer facilement l'agencement de plusieurs Dockers entre eux. Docker-Compose permet de spécifier comment lancer plusieurs containers en même temps, et de gérer les liens entre eux.")]),e._v(" "),s("p",[e._v("Installer d'abord curl avec la commande "),s("code",[e._v("apt install curl")]),e._v(" puis lancer les commandes suivantes :")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("sudo curl -L https://github.com/docker/compose/releases/download/1.20.1/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose\n\nsudo chmod +x /usr/local/bin/docker-compose\n\n")])])]),s("p",[e._v("Une fois installé, on écrit un fichier "),s("code",[e._v("docker-compose.yml")]),e._v(" à la racine de notre projet qui démarre un serveur apache.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('version: \'3.3\'\n\nservices:\n   web:\n      image: webdevops/php-apache:ubuntu-16.04\n      container_name: web\n      ports:\n         - "80:80"\n         - "443:443"\n      volumes:\n         - "$PWD/:/app/"\n')])])]),s("ul",[s("li",[e._v("Que veut dire chaque ligne ?")])]),e._v(" "),s("p",[e._v("Une fois le fichier docker-compose adapté à vos besoins, il ne reste plus qu'à démarrer l'environnement. Pour cela veillez à être dans le répertoire contenant votre fichier "),s("code",[e._v("docker-compose.yml")]),e._v(" puis lancer la commande suivante pour builder les containers:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("docker-compose up -d\n")])])]),s("ul",[s("li",[e._v("Etudier chaque parametère de la commande "),s("code",[e._v("docker-compose")]),e._v(" à l'aide de l'option `--help``")])]),e._v(" "),s("p",[e._v("Nous allons maintenant adapter le fichier "),s("code",[e._v("docker-compose.yml")]),e._v(" pour créer un blog WordPress avec une instance de base de données MySQL séparée et qui utilise un volume de données.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("version: '3.3'\n\nnetworks:\n   mon_reseau:\n     driver: bridge \n     ipam:\n       config:\n        - subnet: 10.16.0.0/24\nvolumes:\n    dbdata:\n\nservices:\n   db:\n     image: mysql:5.7\n     container_name: mysql\n     volumes:\n       - dbdata:/var/lib/mysql\n     restart: always\n     environment:\n       MYSQL_ROOT_PASSWORD: somewordpress\n       MYSQL_DATABASE: wordpress\n       MYSQL_USER: wordpress\n       MYSQL_PASSWORD: wordpress\n     networks:\n       - mon_reseau\n\n   wordpress:\n     depends_on:\n       - db\n     image: wordpress:latest\n     container_name: wordpress\n     ports:\n       - \"8000:80\"\n     restart: always\n     environment:\n       WORDPRESS_DB_HOST: db:3306\n       WORDPRESS_DB_USER: wordpress\n       WORDPRESS_DB_PASSWORD: wordpress\n     networks:\n       mon_reseau:\n          ipv4_address: 10.16.0.100     \n")])])]),s("p",[e._v("Le fichier docker-compose ci-dessus va créer un réseau et 2 containers. Le fichier contient tous les paramètres de connexions à la base données, de l'applicatif, réseau (adresses et mapping des ports) ainsi que le répertoire des volumes persistants.")]),e._v(" "),s("p",[e._v("Démarrer l'environnement et vérifier votre serveur en visitant la page "),s("code",[e._v("http://localhost:8000")])]),e._v(" "),s("h3",{attrs:{id:"installation-d-un-orchestrateur-pour-docker-portainer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#installation-d-un-orchestrateur-pour-docker-portainer"}},[e._v("#")]),e._v(' Installation d’un orchestrateur pour docker "portainer"')]),e._v(" "),s("p",[e._v("Si vous cherchez une interface graphique pour gérer votre environnement docker, portainer est fait pour vous!")]),e._v(" "),s("p",[e._v("Portainer est une GUI à docker open source. Il permet d’avoir une jolie interface graphique pour manipuler et visualiser vos docks. On peut en créer, stopper, lancer, visualiser les stats etc etc. Portainer s’installe lui-même sur docker (Inception ?!!).")]),e._v(" "),s("p",[e._v("Ajouter le container suivant à votre fichier, rédemarrer le docker composer puis visiter la page "),s("code",[e._v("http://localhost:9000")]),e._v(" pour continuer la configuration en mode local.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('   portainer:\n     image: portainer/portainer\n     container_name: portainer\n     ports:\n       - "9000:9000"\n     volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n     networks:\n       - mon_reseau\n\n')])])]),s("ul",[s("li",[e._v("Etudier l'interface de portainer")]),e._v(" "),s("li",[e._v("Modifier le fichier yml afin d'ajouter les services suivants :\n"),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/phpmyadmin/docker/blob/master/docker-compose.yml",target:"_blank",rel:"noopener noreferrer"}},[e._v("phpmyadmin"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://hub.docker.com/_/postgres/",target:"_blank",rel:"noopener noreferrer"}},[e._v("postgresql"),s("OutboundLink")],1)])])])])])}),[],!1,null,null,null);r.default=a.exports}}]);